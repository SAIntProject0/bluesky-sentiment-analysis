<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ReviewSky Debug Dashboard</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #f5f5f5; }
    .card { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h1>🔍 ReviewSky Debug Dashboard</h1>
  
  <div class="card">
    <strong>Last update:</strong> <span id="timestamp">Loading...</span>
  </div>

  <div class="card">
    <h3>📊 Sentiment Counts</h3>
    <div>Positive: <span id="pos">?</span></div>
    <div>Neutral: <span id="neut">?</span></div>
    <div>Negative: <span id="neg">?</span></div>
  </div>

  <div class="card">
    <h3>📂 Categories</h3>
    <div id="categories">Loading...</div>
  </div>

  <div class="card">
    <h3>🧾 First Post Preview</h3>
    <div id="first-post">No posts</div>
  </div>

  <div class="card">
    <h3>📡 Raw JSON (for debugging)</h3>
    <pre id="raw" style="max-height:200px; overflow:auto;"></pre>
  </div>

  <script>
    async function load() {
      try {
        // Fetch with cache-busting
        const res = await fetch('data/sentiment.json?' + Date.now());
        if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        
        const data = await res.json();
        document.getElementById('raw').textContent = JSON.stringify(data, null, 2);

        // Update UI
        document.getElementById('timestamp').textContent = new Date(data.timestamp).toString();
        document.getElementById('pos').textContent = data.sentiment?.Positive || 0;
        document.getElementById('neut').textContent = data.sentiment?.Neutral || 0;
        document.getElementById('neg').textContent = data.sentiment?.Negative || 0;

        // Categories
        const catDiv = document.getElementById('categories');
        catDiv.innerHTML = '';
        for (const [cat, count] of Object.entries(data.categories || {})) {
          const p = document.createElement('div');
          p.textContent = `${cat}: ${count}`;
          catDiv.appendChild(p);
        }

        // First post
        if (data.posts && data.posts.length > 0) {
          const p = data.posts[0];
          document.getElementById('first-post').innerHTML = 
            `<strong>@${p.handle}</strong> [${p.category}]<br>${p.text}<br><em>${p.label} (${(p.score*100).toFixed(1)}%)</em>`;
        }

        console.log("✅ Data loaded successfully", data);
      } catch (err) {
        console.error("❌ Load failed", err);
        document.getElementById('timestamp').className = 'error';
        document.getElementById('timestamp').textContent = 'ERROR: ' + err.message;
      }
    }

    load();
    setInterval(load, 30000);
  </script>
</body>
</html>
